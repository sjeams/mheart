{"version":3,"sources":["assets\\Script\\http.js"],"names":["https_url","HttpHelper","cc","Class","Component","statics","properties","onLoad","current","audioEngine","play","res","url","httpUrl","new_url","httpUrlJson","httpGets","callback","xhr","loader","getXMLHttpRequest","onreadystatechange","readyState","status","respone","responseText","open","sys","isNative","setRequestHeader","timeout","send","httpPostLogin","params","token","localStorage","getItem","JSON","parse","stringify","httpPost","new_respone","code","director","loadScene","playGame","sence","loadRes","errorMessage","loadedResource","log","Prefab","TipBoxPrefab","instantiate","find","addChild","preloadScene","completeCount","totalCount","item","progressBar","getComponent","ProgressBar","progress","resource","sys_label","Label","string","parseInt","httpRequest"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * Http 请求封装\r\n */\r\nvar https_url = 'https://www.aheart.cn';\r\nconst HttpHelper = cc.Class({\r\n    extends: cc.Component,\r\n\r\n    statics: {\r\n    },\r\n\r\n    properties: {\r\n\r\n    },\r\n    onLoad () {\r\n        \r\n        // 从服务器加载mp3来进行播放\r\n        this.current = cc.audioEngine.play(res.url, false, 1);  \r\n    },\r\n    /**\r\n     * get请求\r\n     * @param {string} url\r\n     * @param {function} callback \r\n     */\r\n        httpUrl(new_url){\r\n            return https_url+'/app/api/file-content?url='+https_url+new_url;\r\n            //https://www.aheart.cn/app/api/file-content?url=https://www.aheart.cn/app/loading/loading.jpg\r\n        },\r\n        httpUrlJson(new_url){\r\n            return https_url+'/app/api/file-json?url='+https_url+new_url;\r\n            //https://www.aheart.cn/app/api/file-content?url=https://www.aheart.cn/app/loading/loading.jpg\r\n        },\r\n        httpGets: function (url, callback) {\r\n            var url =https_url+url;\r\n            var xhr = cc.loader.getXMLHttpRequest();\r\n            xhr.onreadystatechange = function () {\r\n                if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n                    var respone = xhr.responseText;\r\n                    callback(respone);\r\n                }\r\n            };\r\n            xhr.open(\"GET\", url, true);\r\n            if (cc.sys.isNative) {\r\n                xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\");\r\n            }\r\n        \r\n            // note: In Internet Explorer, the timeout property may be set only after calling the open()\r\n            // method and before calling the send() method.\r\n            xhr.timeout = 5000;// 5 seconds for timeout\r\n        \r\n            xhr.send();\r\n        },\r\n        \r\n        httpPostLogin: function (url, params, callback) {\r\n            var token = cc.sys.localStorage.getItem('token');\r\n            params['token'] = token;\r\n            var url =https_url+url;\r\n            var xhr = cc.loader.getXMLHttpRequest();\r\n            xhr.onreadystatechange = function () {\r\n                // cc.log('xhr.readyState='+xhr.readyState+'  xhr.status='+xhr.status);\r\n                if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n                    var respone = xhr.responseText;\r\n                    callback(JSON.parse(respone));  // json 转数组\r\n                }else{\r\n                    //   callback(-1);\r\n                }\r\n            };\r\n            xhr.open(\"POST\", url, true);\r\n            if (cc.sys.isNative) {\r\n                xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\");\r\n            }\r\n            // xhr.setRequestHeader(\"Http-Edition\", \"1.0.0.0\");  // 版本\r\n            // xhr.setRequestHeader(\"Ip\", \"192.168.1.1\");\r\n            // xhr.setRequestHeader(\"Http-Token\", \"gzipdeflate\");\r\n            xhr.timeout = 5000;// 5 seconds for timeout\r\n            // xhr.setRequestHeader('Content-Type', 'application/json,multipart/form-data');\r\n            xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded; charset=utf-8\")\r\n            // xhr.send(JSON.stringify(params));\r\n            xhr.send('data='+JSON.stringify(params));\r\n            //  xhr.send(params);\r\n\r\n        },\r\n        //带token访问\r\n        httpPost: function (url, params, callback) {\r\n            var token = cc.sys.localStorage.getItem('token');\r\n            params['token'] = token;\r\n            var url =https_url+url;\r\n            var xhr = cc.loader.getXMLHttpRequest();\r\n            xhr.onreadystatechange = function () {\r\n                // cc.log('xhr.readyState='+xhr.readyState+'  xhr.status='+xhr.status);\r\n                if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n                    var respone = xhr.responseText;\r\n                    var new_respone =JSON.parse(respone);\r\n                    if(new_respone.code==0){\r\n                        //未登录\r\n                        // console.log(JSON.parse(respone))\r\n                        cc.director.loadScene('index');\r\n                    }else{\r\n                        callback(JSON.parse(respone));  // json 转数组\r\n                    }\r\n                }else{\r\n                    //   callback(-1);\r\n                }\r\n            };\r\n            xhr.open(\"POST\", url, true);\r\n            if (cc.sys.isNative) {\r\n                xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\");\r\n            }\r\n            // xhr.setRequestHeader(\"Http-Edition\", \"1.0.0.0\");  // 版本\r\n            // xhr.setRequestHeader(\"Ip\", \"192.168.1.1\");\r\n            // xhr.setRequestHeader(\"Http-Token\", \"gzipdeflate\");\r\n            xhr.timeout = 5000;// 5 seconds for timeout\r\n            // xhr.setRequestHeader('Content-Type', 'application/json,multipart/form-data');\r\n            // xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n            xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded; charset=utf-8\")\r\n            // xhr.send(JSON.stringify(params));\r\n            xhr.send('data='+JSON.stringify(params));\r\n            //  xhr.send(params);\r\n\r\n        },\r\n        //场景加载--进度条\r\n        playGame(sence) {\r\n            //加载预制资源 PrefabUrl为 预制资源在 资源中的路径\r\n            cc.loader.loadRes('/sprite_loading', function(errorMessage,loadedResource){\r\n                //检查资源加载\r\n                if( errorMessage ) { cc.log( '载入预制资源失败, 原因:' + errorMessage ); return; }\r\n                if( !(loadedResource instanceof cc.Prefab ) ) { cc.log( '你载入的不是预制资源!' ); return; }\r\n                //开始实例化预制资源\r\n                var TipBoxPrefab = cc.instantiate(loadedResource);\r\n                //将预制资源添加到父节点\r\n                // CanvasNode.addChild(TipBoxPrefab);\r\n                cc.find('Canvas').addChild(TipBoxPrefab);\r\n                //预加载场景并获得加载进度\r\n                cc.director.preloadScene(sence,function (completeCount, totalCount,item) {\r\n                    var progressBar = cc.find('Canvas/loading/progressBar').getComponent(cc.ProgressBar);\r\n                    // console.log(item)\r\n                    // console.log(completeCount)\r\n                    // console.log(totalCount)\r\n                    //加载进度回调\r\n                    // console.log('资源 ' + completeCount + '加载完成！资源加载中...');\r\n                    // console.log('加载场景资源');\r\n                    progressBar.progress = completeCount / totalCount;\r\n                    // console.log(progressBar.progress)\r\n                    progressBar.completeCount = completeCount;\r\n                    progressBar.totalCount = totalCount;\r\n                    resource = item;\r\n                    // // 代码里面获取cc.Label组件, 修改文本内容\r\n                    // //在代码里面获取cc.Label组件\r\n                    var sys_label = cc.find('Canvas/loading/progressBar/sys_label').getComponent(cc.Label);\r\n                    sys_label.string = parseInt( progressBar.progress * 100) + '%';\r\n                    // if( this.resource.type=='mp3'){\r\n                    //     // console.log(res);  // mp3\r\n                    //     // this.audio.clip = res;\r\n                    //     // this.audio.play();\r\n                    //     // 从服务器加载mp3来进行播放\r\n                    //     this.current = cc.audioEngine.play(res.url, false, 1);\r\n                    // }\r\n                }, function (){\r\n                    // progressBar.hide();\r\n                    //加载场景\r\n                    cc.director.loadScene(sence, function () {  });\r\n                })\r\n            });\r\n        },\r\n});\r\nhttpRequest = new HttpHelper();\r\n// window.HttpHelper = new HttpHelper();"]}