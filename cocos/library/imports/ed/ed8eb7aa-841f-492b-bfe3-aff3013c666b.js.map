{"version":3,"sources":["assets\\Script\\战斗\\score_fighting.js"],"names":["require","cc","Class","Component","properties","toolsArray","fightingArray","content","Node","person","Prefab","home","reload","back","back_time","test_scrollView","type","ScrollView","test_pageView","PageView","init","director","getScene","onLoad","sys","BoxPrefab","find","spawnTools","playTask","goPlay","fighting_boat","start","update","dt","Promise","resolve","_this","figthing_remote_url","localStorage","getItem","httpRequest","playGame","remoteUrl","httpUrlJson","loader","load","url","err","data","http_globalData","fighting","unscheduleAllCallbacks","biolgy_state","poition_my","poition_enemy","getComponent","biology_detail_list","length","console","log","fighting_list","boat_length","fighting_history","history_count","fightingEnd","boat","boat_count","bpage","total","active","Label","string","parseInt","runAction","sequence","scaleTo","on","onButtonClicked","event","his_log","h_yubei","readySkill","h_need","h_go","playSkill","h_do","h_putong","playFight","loadRes","errorMessage","loadedResource","TipBoxPrefab","instantiate","poition_winner","getChildByName","addChild","addMapPic","map_pic","httpUrl","texture","Sprite","spriteFrame","SpriteFrame","his_log_extend","npage","biology","_this_hero_node","goid","_targ_hero_node","doid","buttonReady","needSkill","httpRequestFightingExtend","playAction","buttonMove","node","actionhiddenBig","spawn","callFunc","playTips","actionhiddenSmoll","m_node","arr","m_x","m_y","m_x_move","is_my","x","y","actionLeft","moveBy","v2","is_shanbi","buttonMoveOut","buttonShake","actionRight","position_my","actionRightSecond","actionhiddenOn","fadeTo","actionhiddenoff","bagBtn","gridLayout","parent","forEach","element","removeFromParent","hp_update","hp","fill","all_hp","hp_now","fillstart","act_shan","repeat","reloadWord","httpPost","addWordMap","back_map","removeBoxprefab","back_reload","back_home","addTouchEvent","node_1","EventType","TOUCH_START","touchStart","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","removeAllChildren","destroyAllChildren"],"mappings":"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","sourceRoot":"/","sourcesContent":["require(\"../common\"); \r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n      // 根据TOOLS生成相应的道具\r\n      toolsArray:[],\r\n      fightingArray:[],   \r\n      content: cc.Node,\r\n      person: cc.Prefab,\r\n      home: cc.Node,\r\n      reload: cc.Node,\r\n      back: cc.Node,\r\n      back_time: cc.Node, //跳过回合\r\n      //列表\r\n      test_scrollView: {\r\n        default: null,\r\n        type: cc.ScrollView\r\n      },\r\n      //翻页容器\r\n      test_pageView: {\r\n        default: null,\r\n        type: cc.PageView\r\n      },\r\n\r\n    },\r\n    init(){\r\n      cc.director.getScene();//获取当前场景\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n    async onLoad () {\r\n      //全局定义容器节点\r\n      cc.sys.BoxPrefab= cc.find('Canvas/大厅/content');\r\n      cc.sys.fightingArray=[]\r\n      cc.sys.toolsArray=[]\r\n      // this.spawnTools()\r\n      await this.spawnTools() //加载数据\r\n      this.playTask()\r\n    },\r\n    //task\r\n    async playTask(){\r\n      await this.goPlay() //实例化对象\r\n      await this.fighting_boat() //开启回合战斗\r\n\t  },\r\n\r\n\r\n\r\n \r\n    start () {\r\n    },\r\n    update (dt) {\r\n      // console.log(3333)\r\n    },\r\n    spawnTools () {\r\n      return new Promise(resolve => {\r\n      var _this =this;\r\n      var figthing_remote_url = cc.sys.localStorage.getItem('figthing_remote_url'); //读取数据--战斗记录\r\n\r\n      if(figthing_remote_url==null){\r\n          httpRequest.playGame(\"sence_ditu\")\r\n          resolve(); \r\n      }else{\r\n        var remoteUrl = httpRequest.httpUrlJson(figthing_remote_url);\r\n        cc.loader.load({ url: remoteUrl }, function (err, data) {\r\n          //定义常量\r\n          http_globalData.fighting = data;\r\n          //开启战斗\r\n          resolve(); \r\n          //  await   _this.goPlay( )\r\n        });    \r\n      }\r\n      })\r\n    },\r\n\r\n    //开启战斗--加载生物\r\n    async goPlay( ){\r\n      // return new Promise(resolve => {\r\n        //播放器先清除所有定时器\r\n        this.unscheduleAllCallbacks();//停止某组件的所有计时器\r\n        let data = http_globalData.fighting\r\n        // cc.log(data)\r\n        var biolgy_state = data.data.biolgy_state;\r\n        var poition_my = data.data.poition_my;\r\n        var poition_enemy = data.data.poition_enemy;\r\n        //生物挂载\r\n        var BoxPrefab = cc.sys.BoxPrefab\r\n        await BoxPrefab.getComponent('fightingTools').biology_detail_list(BoxPrefab,poition_my,biolgy_state,1,0) //挂载生物--position_my\r\n        await BoxPrefab.getComponent('fightingTools').biology_detail_list(BoxPrefab,poition_enemy,biolgy_state,0,poition_my.length) //挂载生物--position_ememy\r\n\r\n        // await this.biology_detail_list(BoxPrefab,poition_my,biolgy_state,1,0) //挂载生物--position_my\r\n        // await this.biology_detail_list(BoxPrefab,poition_enemy,biolgy_state,0,poition_my.length) //挂载生物--position_ememy\r\n      // _this.addMapPic(data) //生成地图\r\n      // console.log( _this.toolsArray)\r\n      console.log( cc.sys.fightingArray )\r\n        // resolve();})\r\n    },\r\n    // 战斗回合\r\n    async fighting_boat(){\r\n      var _this =this;\r\n      // return new Promise(resolve => {\r\n      var fighting_list =  http_globalData.fighting.data;    \r\n      var boat_length = fighting_list.fighting_history.length\r\n      var history_count =  fighting_list.history_count\r\n      var fighting_history= fighting_list.fighting_history;\r\n      //先加载弹窗结果\r\n      _this.fightingEnd(fighting_list)\r\n      if(boat_length!=0){\r\n        var boat=0;\r\n        var boat_count=-1;\r\n        //一条或多条执行语句\r\n        // _this.schedule(function(){\r\n        //循环历史行动条数\r\n        for (var bpage=0; bpage<boat_length; bpage++){\r\n        // _this.schedule(function(){\r\n            boat_count++\r\n            if(history_count[boat].total<boat_count){\r\n              boat++;\r\n            }\r\n            //因为是从0开始，所以相等就结束 \r\n            if(boat_count==boat_length){\r\n              // cc.log(111)\r\n              // 在第六次执行回调时取消这个计时器\r\n              // _this.fightingEnd(fighting_list)\r\n              cc.find('Canvas/结算').active =true;// 结束弹窗结果\r\n              // _this.unschedule();\r\n              _this.unscheduleAllCallbacks();//停止某组件的所有计时器\r\n            }else{\r\n              //判断下动作是否已经下一回合\r\n              if(cc.find('Canvas/大厅/time').getComponent(cc.Label).string!='第'+ parseInt(boat+1)+'回合' ){\r\n                cc.find('Canvas/大厅/time').getComponent(cc.Label).string = '第'+ parseInt(boat+1)+'回合'                    \r\n                cc.find('Canvas/大厅/time').runAction(cc.sequence(cc.scaleTo(0.3, 2, 2),cc.scaleTo(0.3, 1,1)));//建一个缩放到1.5倍大小的动作，持续时间2秒\r\n              }\r\n              // cc.log(fighting_history[boat_count])\r\n              //如果是空回合 ，等待跳过\r\n              if(fighting_history[boat_count]){\r\n                await   _this.fighting_history(fighting_history[boat_count])//执行战斗顺序 \r\n              }\r\n            }\r\n          // 绑定点击事件\r\n          _this.back_time.on('click', _this.onButtonClicked,this);    \r\n        // },1,boat_length,1.5);////2秒后执行1次间隔5秒\r\n          }\r\n      }\r\n      // resolve();})\r\n    },\r\n \r\n    //暂停并且跳过回合\r\n    onButtonClicked: function(event) {\r\n      // 跳过回合\r\n      // var _this =this\r\n      // _this.unscheduleAllCallbacks();//停止某组件的所有计时器\r\n      //   cc.log('跳过')\r\n    },\r\n\r\n    async fighting_history(his_log) {\r\n      // return new Promise(resolve => {\r\n        var _this = this;\r\n        //预备回合\r\n        if(his_log.h_yubei.length!=0){\r\n          await  _this.readySkill(his_log.h_yubei)\r\n          // cc.log('预备回合')\r\n        }\r\n        //回合结束\r\n        // if(his_log.h_end.length!=0){\r\n        //   cc.log('回合结束')\r\n        // }\r\n        // cc.log(his_log)\r\n\r\n        //反击\r\n        // if(his_log.h_back.length!=0){\r\n        //   _this.playFight(_this_hero_node,_targ_hero_node,biology,his_log.h_back)\r\n        // }\r\n        //消耗魔法 --技能名称和消耗放一起了\r\n        if(his_log.h_need.length!=0){\r\n          await     _this.readySkill(his_log.h_need)\r\n        }\r\n        // //go和do 二选一 ，need 必有   \r\n        // // 发起技能名称被动\r\n        if(his_log.h_go.length!=0){\r\n          await   _this.playSkill(his_log.h_go)\r\n        }\r\n        // 执行技能\r\n        if(his_log.h_do.length!=0){\r\n          await  _this.playSkill(his_log.h_do)\r\n        }\r\n        //普通攻击\r\n        if(his_log.h_putong.length!=0){\r\n          await    _this.playFight(his_log.h_putong)\r\n        }\r\n      // resolve();})\r\n    },\r\n      //战斗结束\r\n    fightingEnd(fighting_list) {\r\n        // var _task =task||0;\r\n        var _this =this;\r\n        //加载预制资源 PrefabUrl为 预制资源在 资源中的路径\r\n        cc.loader.loadRes('/model弹窗/biology_结算', function(errorMessage,loadedResource){\r\n            //检查资源加载\r\n            if( errorMessage ) { cc.log( '载入预制资源失败, 原因:' + errorMessage ); return; }\r\n            if( !(loadedResource instanceof cc.Prefab ) ) { cc.log( '你载入的不是预制资源!' ); return; }\r\n            //开始实例化预制资源\r\n            var TipBoxPrefab = cc.instantiate(loadedResource);\r\n            // TipBoxPrefab.getComponent('fightingTools').initInfo(fighting_list); //写入奖励物品预制体\r\n            if(fighting_list.poition_winner==1){\r\n              TipBoxPrefab.getChildByName('结果s').getComponent(cc.Label).string='胜利！';\r\n            }else{\r\n              TipBoxPrefab.getChildByName('结果s').getComponent(cc.Label).string='失败！';\r\n            }\r\n            //将预制资源添加到父节点\r\n            // CanvasNode.addChild(TipBoxPrefab);\r\n            cc.find('Canvas/结算/弹框').addChild(TipBoxPrefab,this);\r\n            //请求战斗记录\r\n            // if(_task==1){\r\n            //     console.log(11111)\r\n            //     _this.fightint(sence);\r\n            // }else{\r\n            //     _this.progress(sence);\r\n            // }\r\n        });\r\n    },\r\n\r\n    //生成地图\r\n    addMapPic(data){\r\n        var _this = this;\r\n        var  map_pic =data.data['map_pic'];\r\n        var remoteUrl = httpRequest.httpUrl(map_pic);\r\n        // console.log(remoteUrl)\r\n        cc.loader.load({ url: remoteUrl }, function (err, texture) {  \r\n          if(texture!=null){\r\n          _this.home.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\r\n          }\r\n        });\r\n    },\r\n \r\n    //技能准备动作\r\n    async  readySkill(his_log_extend){\r\n      // return new Promise(resolve => {\r\n        if(his_log_extend.length!=0){\r\n          var _this =this\r\n          for (var npage=0; npage<his_log_extend.length; npage++){\r\n            var biology = his_log_extend[npage];\r\n            var _this_hero_node =cc.sys.fightingArray[biology.goid]\r\n            var _targ_hero_node =cc.sys.fightingArray[biology.doid]\r\n          \r\n            await  _this.buttonReady(_this_hero_node,biology)//自己变大--加载技能动作\r\n            }\r\n        } \r\n      // resolve();})\r\n    },\r\n    //技能消耗动作\r\n    needSkill(his_log_extend){\r\n      return new Promise(resolve => {\r\n      if(his_log_extend.length!=0){\r\n        var _this =this\r\n        for (var npage=0; npage<his_log_extend.length; npage++){\r\n          var biology = his_log_extend[npage];\r\n          \r\n          var _this_hero_node =cc.sys.fightingArray[biology.goid]\r\n          var _targ_hero_node =cc.sys.fightingArray[biology.doid]\r\n          // _this.buttonShake(0.5,_targ_hero_node,biology)//技能攻击\r\n          // _this.schedule(function(){\r\n          httpRequestFightingExtend.playAction(_targ_hero_node,biology,0) //不需要其它动作，瞬发伤害动作\r\n          // },1)\r\n        }\r\n      }\r\n     resolve();})\r\n    },\r\n    //技能攻击动作\r\n    playSkill(his_log_extend){\r\n      return new Promise(resolve => {\r\n      if(his_log_extend.length!=0){\r\n        var _this =this\r\n        for (var npage=0; npage<his_log_extend.length; npage++){\r\n          var biology = his_log_extend[npage];\r\n          \r\n          var _this_hero_node =cc.sys.fightingArray[biology.goid]\r\n          var _targ_hero_node =cc.sys.fightingArray[biology.doid]\r\n          //2个攻击类型只能二选一 \r\n          // _this.buttonShake(0.1,_targ_hero_node,biology)//技能攻击，动作后伤害\r\n            httpRequestFightingExtend.playAction(_targ_hero_node,biology,1) //不需要其它动作，瞬发伤害动作\r\n        }\r\n      }\r\n    resolve();})\r\n    },\r\n    //普通攻击动作\r\n    async  playFight(his_log_extend){\r\n      // cc.log(444)\r\n      // return new Promise(resolve => {\r\n      if(his_log_extend.length!=0){\r\n        var _this =this\r\n        for (var npage=0; npage<his_log_extend.length; npage++){\r\n          var biology = his_log_extend[npage];\r\n          // cc.log(cc.sys.fightingArray)\r\n          var _this_hero_node =cc.sys.fightingArray[biology.goid]\r\n          var _targ_hero_node =cc.sys.fightingArray[biology.doid]\r\n          if(biology.goid==biology.doid){\r\n              // _this.buttonShake(0,_targ_hero_node,biology)//自己闪动\r\n            await  _this.buttonReady(_this_hero_node,biology)//自己变大--加载技能动作\r\n          }else{\r\n            await _this.buttonMove(_this_hero_node,_targ_hero_node,biology) //移动\r\n          }\r\n        }\r\n      }\r\n    // resolve();})\r\n    },\r\n    //准备动作--变大\r\n    async buttonReady(node,biology) {\r\n      return new Promise(resolve => {\r\n        // var _this =this\r\n        // var waite_time=waite_time||0\r\n        const actionhiddenBig =   cc.spawn(cc.scaleTo(0.1, 1.1, 1.1),cc.callFunc(function(){\r\n          //等待攻击完成\r\n            httpRequestFightingExtend.playTips(node,biology)\r\n        },this));//变大还原//变大\r\n        // const actionWaite =cc.delayTime(waite_time);//等待攻击时间\r\n\r\n        // const actionLeft = cc.moveBy(0.1, cc.v2(-5, 0));\r\n        // const actionRight = cc.moveBy(0.1, cc.v2(10, 0));\r\n        // const actionLeftSecond = cc.moveBy(0.1, cc.v2(-10, 0));\r\n        // const actionRightSecond = cc.moveBy(0.1, cc.v2(5, 0));\r\n        // actionLeft, actionRight, actionLeftSecond, actionRightSecond,\r\n        //闪烁\r\n        // const actionhiddenOn = cc.fadeTo(0.1,0);\r\n        // const actionhiddenoff = cc.fadeTo(0.1,255); \r\n        const actionhiddenSmoll =  cc.scaleTo(0.2,1,1)//变大还原\r\n        // cc.spwan( 同时完成\r\n\r\n            node.runAction(\r\n                cc.sequence(actionhiddenBig,actionhiddenSmoll,\r\n                // 执行动作完成之后调用的方法\r\n                cc.callFunc(() => {\r\n \r\n                    //先走提示再动作\r\n                    // _this.schedule(function(){\r\n                    // httpRequestFightingExtend.playTips(node,biology)\r\n                    httpRequestFightingExtend.playAction(node,biology)\r\n                    // },1)\r\n                    resolve();\r\n                }) )\r\n            );\r\n        });\r\n    },\r\n    //移动\r\n    async buttonMove(node,m_node,biology) {\r\n      return new Promise(resolve => {\r\n        var arr =[];\r\n        var _this =this;\r\n        var m_x=10\r\n        var m_y=0\r\n        var m_x_move =0\r\n        if (node.is_my==1){\r\n          m_x_move =-120\r\n        }else{\r\n          m_x_move =120\r\n        }    \r\n        if (node.x != m_node.x) m_x = m_node.x - node.x+m_x_move\r\n        if (node.y != m_node.y) m_y = m_node.y - node.y \r\n        //普通攻击\r\n        const actionLeft = cc.spawn(cc.moveBy(0.1,cc.v2(m_x,m_y)),cc.scaleTo(0.1, 1, 1.2),cc.callFunc(function(){\r\n                //等待攻击完成  \r\n                if(biology.is_shanbi){\r\n                  //闪避，后移\r\n                    _this.buttonMoveOut(m_node,biology)\r\n                }else{\r\n                  //受伤，闪烁\r\n                  _this.buttonShake(m_node,biology)\r\n                }\r\n\r\n        },this)) \r\n        // const actionWaite = cc.delayTime(0.01) \r\n        //返回位置\r\n        const actionRight =cc.spawn(cc.moveBy(0.1,cc.v2(-m_x,-m_y)),cc.scaleTo(0.1, 1, 1),cc.callFunc(function(){\r\n            // //等待攻击完成\r\n            // _this.buttonShake(m_node,biology)\r\n        },this))\r\n        // 让节点在向上移动的同时缩放\r\n        // arr.push(cc.scaleTo(0.1, 1,1))\r\n        node.runAction(\r\n            cc.sequence(actionLeft,actionRight,cc.callFunc(() => {    \r\n              resolve(); //执行完动作再回调\r\n            }))\r\n        );\r\n      });\r\n  },\r\n\r\n\r\n  //闪避     // cc.spwan( 同时完成  cc.sequence( 按顺序执行\r\n    buttonMoveOut(node,biology) {\r\n \r\n      if(biology.position_my==1){\r\n        //己方 后移\r\n        const actionLeft = cc.moveBy(0.1, cc.v2(30, 5));\r\n        const actionRightSecond = cc.moveBy(0.1, cc.v2(-30, -5));\r\n\r\n          node.runAction(\r\n                cc.sequence(actionLeft,actionRightSecond,\r\n                // 执行动作完成之后调用的方法\r\n                    cc.callFunc(() => {\r\n \r\n                        // _this.schedule(function(){\r\n                        httpRequestFightingExtend.playAction(node,biology)\r\n                        // },1)\r\n                        // resolve();\r\n                  }) )\r\n            );\r\n\r\n      }else{\r\n        //敌方方 前移\r\n        const actionLeft = cc.moveBy(0.1, cc.v2(-30, 5));\r\n        const actionRightSecond = cc.moveBy(0.1, cc.v2(30, -5));\r\n \r\n            node.runAction(\r\n                cc.sequence(actionLeft,actionRightSecond,\r\n                // 执行动作完成之后调用的方法\r\n                    cc.callFunc(() => {\r\n \r\n                        // _this.schedule(function(){\r\n                        httpRequestFightingExtend.playAction(node,biology)\r\n                        // },1)\r\n                        // resolve();\r\n                  }) )\r\n            );\r\n      \r\n      }\r\n   \r\n  },\r\n  //受击\r\n  buttonShake(node,biology) {\r\n    // var _this =this;\r\n    // var waite_time=waite_time||0\r\n    // const actionWaite =cc.delayTime(waite_time);//等待攻击时间\r\n    const actionhiddenOn = cc.fadeTo(0.1,0);\r\n    // const actionLeft = cc.moveBy(0.1, cc.v2(-10, 0));\r\n    // const actionRight = cc.moveBy(0.1, cc.v2(10, 0));\r\n    // const actionLeftSecond = cc.moveBy(0.1, cc.v2(-10, 0));\r\n    // const actionRightSecond = cc.moveBy(0.1, cc.v2(10, 0));\r\n    const actionhiddenoff = cc.fadeTo(0.1,255);\r\n    // cc.spwan( 同时完成\r\n    // return new Promise(resolve => {\r\n        node.runAction(\r\n            cc.sequence(actionhiddenOn,actionhiddenoff,\r\n            // cc.sequence(actionhiddenOn,actionLeft,actionhiddenoff,actionhiddenoff,\r\n            // cc.sequence(actionLeft, actionRight, actionLeftSecond, actionRightSecond,actionhiddenOn,actionhiddenoff,\r\n            // 执行动作完成之后调用的方法\r\n                cc.callFunc(() => {\r\n\r\n                    // _this.schedule(function(){\r\n                    httpRequestFightingExtend.playAction(node,biology)\r\n                    // },1)\r\n                    // resolve();\r\n                }) )\r\n        );\r\n    // });\r\n},\r\n    //生物渐隐-淡出-淡入\r\n    // nodefadeIn(time,type,node){\r\n    //   // cc.log(node)\r\n    //   var fin_arr=[];\r\n    //   if(type==0){\r\n    //     //先让透明度为0\r\n    //     node.getChildByName('扣血s').opacity=0\r\n    //     fin_arr.push(cc.fadeIn(time));\r\n    //   }else{\r\n    //     //先让透明度为255\r\n    //     node.getChildByName('扣血s').opacity=255\r\n    //     fin_arr.push(cc.fadeOut(time));\r\n    //   }\r\n    //   fin_arr.push(cc.spawn(cc.delayTime(0.5),cc.callFunc(function(){\r\n    //     node.getChildByName('扣血s').active=false\r\n    //   },this)) )\r\n    //   node.getChildByName('扣血s').runAction(fin_arr);\r\n    // },\r\n    bagBtn () {\r\n      // 背包按钮\r\n      if (this.gridLayout.parent.active) {\r\n          // 隐藏节点\r\n          this.gridLayout.parent.active = false;\r\n\r\n          // 删除所有道具(或者不删，只是隐藏，自己决定)\r\n          // this.toolsArray.forEach(element => {\r\n          //     element.removeFromParent();\r\n          // });\r\n          cc.sys.toolsArray.forEach(element => {\r\n                element.removeFromParent();\r\n            });\r\n      }\r\n      else {\r\n          // 显示节点\r\n          this.gridLayout.parent.active = true;\r\n\r\n          // 生成所有道具\r\n          this.spawnTools();\r\n      }\r\n    },\r\n    // 刷新血条\r\n    hp_update(node){\r\n      //受到15伤害\r\n      this.hp -= 15;\r\n      // 求出伤害血量占比并显示\r\n      let fill = this.hp /this.all_hp;\r\n      this.hp_now.fillstart = 1 - fill; \r\n\r\n      // 血条延迟，秒执行一次，一共执行六次，延迟为0\r\n      // this.schedule(function(){\r\n      //     this.magnetnumber-=5/8;\r\n      // },1,6,0);\r\n\r\n      //0.5秒内闪烁\r\n      let act_shan = cc.sequence(cc .fadeTo(0.05,0),cc.fadeTo(0.05,255));\r\n      element.runAction(cc.repeat(act_shan,5));\r\n      // //0.5秒后还可以被攻击\r\n      //   this.scheduleOnce(function() {\r\n      //     this.state = 0;\r\n      //   }.bind(this),0.5);\r\n    },\r\n    reloadWord(){\r\n      var _this =this;\r\n      httpRequest.httpPost('/app/app-apiword/map-word',{}, function (data) {\r\n        //写入地图数据\r\n        _this.addWordMap(data)\r\n        })\r\n    },\r\n    back_map(){\r\n      //移除节点\r\n      var _this = this;\r\n      _this.removeBoxprefab()\r\n      httpRequest.playGame(\"sence_ditu\")\r\n    },\r\n    //重播\r\n    back_reload(){\r\n      //移除节点\r\n      var _this = this;\r\n      _this.removeBoxprefab()\r\n      _this.playTask( )\r\n      cc.find('Canvas/结算').active =false;// 结束弹窗结果\r\n    },\r\n    back_home(){\r\n      //移除节点\r\n      var _this = this;\r\n      _this.removeBoxprefab()\r\n      httpRequest.playGame(\"sence_dating\")\r\n    },\r\n    addTouchEvent(node_1) {\r\n        node_1.on(cc.Node.EventType.TOUCH_START, this.touchStart, this);\r\n        node_1.on(cc.Node.EventType.TOUCH_MOVE, this.touchMove, this);\r\n        node_1.on(cc.Node.EventType.TOUCH_END, this.touchEnd, this);\r\n    },\r\n    //移除容器\r\n    removeBoxprefab(){\r\n      cc.sys.BoxPrefab.removeAllChildren();\r\n      cc.sys.BoxPrefab.destroyAllChildren();\r\n    }\r\n\r\n \r\n});\r\n"]}