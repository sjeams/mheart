{"version":3,"sources":["assets\\Script\\fighting\\score_fighting.js"],"names":["HttpHelper","require","httpRequest","params","cc","Class","Component","properties","content","Node","person","Prefab","home","reload","back","test_scrollView","type","ScrollView","test_pageView","PageView","onLoad","spawnTools","_this","map_int","sys","localStorage","getItem","userid","playGame","httpPost","data","console","log","remoteUrl","httpUrlJson","sid","loader","load","url","err","results","addMapPic","map_pic","httpUrl","texture","getComponent","Sprite","spriteFrame","SpriteFrame","reloadWord","addWordMap","TOOLS","user_in_word_map","total","length","removeAllChildren","destroyAllChildren","i","map","map_status","tool","instantiate","initInfo","x","y","addChild","back_map","director","loadScene","back_home","addTouchEvent","node_1","on","EventType","TOUCH_START","touchStart","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n// 世界操作  \r\nvar HttpHelper = require(\"../http\"); \r\nvar httpRequest = new HttpHelper();\r\nvar params =[];\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n            //测试item\r\n      //   content: {\r\n      //     default: null,\r\n      //     type: cc.Node\r\n      //   },\r\n\r\n      // person: {\r\n      //   default: null,\r\n      //   type: cc.Prefab\r\n      // },\r\n  \r\n      content: cc.Node,\r\n      person: cc.Prefab,\r\n      home: cc.Node,\r\n      reload: cc.Node,\r\n      back: cc.Node,\r\n      //列表\r\n      test_scrollView: {\r\n        default: null,\r\n        type: cc.ScrollView\r\n      },\r\n      //翻页容器\r\n      test_pageView: {\r\n        default: null,\r\n        type: cc.PageView\r\n      },\r\n\r\n    },\r\n\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad: function () {\r\n        // for (let i = 0; i < 10; i++) {\r\n        //     let person = cc.instantiate(this.person);\r\n        //     this.conten=person\r\n        //     // person.parent = this.content;\r\n        //     // this.addTouchEvent(person);  //添加触摸事件\r\n        //   }\r\n        // this.value_set = [];\r\n        // // 如果你这里是排行榜，那么你就push排行榜的数据;\r\n        // for(var i = 1; i <= 100; i ++) {\r\n        //     this.value_set.push(i);\r\n        // }\r\n\r\n        // this.content = this.scroll_view.content;\r\n        // this.opt_item_set = [];\r\n        // for(var i = 0; i < this.PAGE_NUM * 3; i ++) {\r\n        //     var item = cc.instantiate(this.item_prefab);\r\n        //     this.content.addChild(item);\r\n        //     this.opt_item_set.push(item);\r\n        // }\r\n      // httpRequest.playGameLoading()\r\n      this.spawnTools()\r\n        // this.scroll_view.node.on(\"scroll-ended\", this.on_scroll_ended.bind(this), this);\r\n    },\r\n\r\n    spawnTools () {\r\n      var _this =this;\r\n      var map_int = cc.sys.localStorage.getItem('figthing_map_int'); //读取数据\r\n      var userid = cc.sys.localStorage.getItem('figthing_userid'); //读取数据\r\n      if(map_int==''&&userid==''){\r\n         httpRequest.playGame('map/诸天地图');\r\n      }else{\r\n          var params = {\r\n            'map_int': map_int,\r\n            'userid': userid,\r\n          };\r\n          httpRequest.httpPost('/app/app-apinew/fight', params, function (data) {\r\n            console.log(111);\r\n              var remoteUrl = httpRequest.httpUrlJson(data.data.sid);\r\n              // cc.assetManager.loadRemote({});  \r\n              cc.loader.load({ url: remoteUrl }, function (err, results) {\r\n                  _this.addMapPic(results) //生成地图\r\n                  // _this.addWordMap(results) //生成生物\r\n                  // _self.node.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture)\r\n                  _this.addMapPic(results) //生成地图\r\n                  // _this.addWordMap(results) //生成生物\r\n              });          \r\n          })   \r\n      }\r\n    },\r\n    //生成地图\r\n    addMapPic(data){\r\n        var _this = this;\r\n        var  map_pic =data.data['map_pic'];\r\n        var remoteUrl = httpRequest.httpUrl(map_pic);\r\n        console.log(remoteUrl)\r\n        cc.loader.load({ url: remoteUrl }, function (err, texture) {  \r\n              _this.home.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\r\n        });\r\n    },\r\n    reloadWord(){\r\n      var _this =this;\r\n      httpRequest.httpPost('/app/app-apiword/map-word', params, function (data) {\r\n        //写入地图数据\r\n        _this.addWordMap(data)\r\n        })\r\n    },\r\n    //生成生物\r\n    addWordMap(data){\r\n      console.log(data) \r\n        var _this = this;\r\n        // 根据MapTools生成相应的道具\r\n        // _this.toolsArray = [];\r\n        let TOOLS = data.data.user_in_word_map;\r\n        var total = data.data.user_in_word_map.length;\r\n  \r\n        // var fi = cc.fadeIn(2)//渐显效果\r\n        // _this.content.runAction(fi);\r\n        // var fo = cc.fadeOut(1)//渐隐效果\r\n        // _this.content.runAction(fo);\r\n        //移除节点\r\n        _this.content.removeAllChildren();\r\n        _this.content.destroyAllChildren();\r\n        //添加节点\r\n        for (let i=0; i<total; i++) {\r\n            // console.log(i) \r\n            //死亡移除map_status\r\n            var map =TOOLS[i];\r\n            if(map.map_status==1){\r\n              // console.log(map.x)\r\n              // console.log(map.y)\r\n              let tool = cc.instantiate(_this.person);\r\n              console.log(map)\r\n              tool.getComponent('fightingTools').initInfo(map);\r\n              tool.x=map.x\r\n              tool.y=map.y\r\n              // _this.toolsArray.push(tool);\r\n              // tool.setPosition(map.x,map.y);  \r\n              _this.content.addChild(tool);   \r\n            }\r\n        }\r\n    },\r\n    back_map(){\r\n      cc.director.loadScene('map/诸天地图');\r\n    },\r\n    back_home(){\r\n      cc.director.loadScene('大厅');\r\n    },\r\n    addTouchEvent(node_1) {\r\n        node_1.on(cc.Node.EventType.TOUCH_START, this.touchStart, this);\r\n        node_1.on(cc.Node.EventType.TOUCH_MOVE, this.touchMove, this);\r\n        node_1.on(cc.Node.EventType.TOUCH_END, this.touchEnd, this);\r\n      },\r\n    // start: function() {\r\n    //     this.start_y = this.content.y;\r\n    //     this.start_index = 0; // 当前我们24个Item加载的 100项数据里面的起始数据记录的索引;\r\n    //     this.load_record(this.start_index);\r\n    // },\r\n\r\n    // // 从这个索引开始，加载数据记录到我们的滚动列表里面的选项\r\n    // load_record: function(start_index) {\r\n    //     this.start_index = start_index;\r\n\r\n    //     for(var i = 0; i < this.PAGE_NUM * 3; i ++) {\r\n    //         var label = this.opt_item_set[i].getChildByName(\"src\").getComponent(cc.Label);\r\n    //         // 显示我们的记录;\r\n    //         label.string = this.value_set[start_index + i];\r\n    //     }\r\n    // },\r\n\r\n    // on_scroll_ended: function() {\r\n    //     this.scrollveiw_load_recode();\r\n    //     this.scroll_view.elastic = true;\r\n    // },\r\n\r\n    // scrollveiw_load_recode: function() {\r\n    //      // 向下加载了\r\n    //     if (this.start_index + this.PAGE_NUM * 3 < this.value_set.length &&\r\n    //         this.content.y >= this.start_y + this.PAGE_NUM * 2 * this.OPT_HEIGHT) { // 动态加载\r\n            \r\n    //         if (this.scroll_view._autoScrolling) { // 等待这个自动滚动结束以后再做加载\r\n    //             this.scroll_view.elastic = false; // 暂时关闭回弹效果\r\n    //             return;\r\n    //         }\r\n\r\n    //         var down_loaded = this.PAGE_NUM;\r\n    //         this.start_index += down_loaded;\r\n    //         if (this.start_index + this.PAGE_NUM * 3 > this.value_set.length) {\r\n    //             var out_len = this.start_index + this.PAGE_NUM * 3 - this.value_set.length;\r\n    //             down_loaded -= (out_len);\r\n    //             this.start_index -= (out_len);\r\n    //         }\r\n    //         this.load_record(this.start_index);\r\n\r\n    //         this.content.y -= (down_loaded * this.OPT_HEIGHT);\r\n    //         return;\r\n    //     }\r\n\r\n    //     // 向上加载\r\n    //     if (this.start_index > 0 && this.content.y <= this.start_y) {\r\n    //         if (this.scroll_view._autoScrolling) { // 等待这个自动滚动结束以后再做加载\r\n    //             this.scroll_view.elastic = false;\r\n    //             return;\r\n    //         }\r\n\r\n    //         var up_loaded = this.PAGE_NUM;\r\n    //         this.start_index -= up_loaded;\r\n    //         if (this.start_index < 0) {\r\n    //             up_loaded += this.start_index;\r\n    //             this.start_index = 0; \r\n    //         }\r\n    //         this.load_record(this.start_index);\r\n    //         this.content.y += (up_loaded * this.OPT_HEIGHT);\r\n    //     }\r\n    //     // end \r\n    // },\r\n    // // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n    //     this.scrollveiw_load_recode();\r\n    // },\r\n});\r\n"]}