{"version":3,"sources":["assets\\Script\\commonApi\\asset.js"],"names":["httpAsset","cc","Class","Component","_progressRuning","completeCount","totalCount","assets","describe","progressBar","find","http_globalData","model_onload_loading_new","getComponent","ProgressBar","progress","sys_label","Label","sys_des","http_globalAsset","loading_asset","http_base_asset_num","type","asset","content","SpriteFrame","newname","name","http_base_asset_biology","string","http_base_asset_zhuangbei","http_base_asset_skill","http_base_asset_xiaoguo","http_base_asset_word","parseInt","_progressCallback","item","length","_completeCallback","err","texture","loadnextScene","url","loader","loadResDir","bind","release","http_base_redict_sence","parent","removeChild","director","preloadScene","httpRequestAsset","loadScene","http_material_yaohuang","Promise","resolve","label","loadRes","Material","res","material_yaohuang","getInstantiatedMaterial","materialTime","materialPrefab","Sprite","setMaterial","time","updateEveryFrame","dt","getMaterial","setProperty","schedule","window"],"mappings":"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","sourceRoot":"/","sourcesContent":["// 加载资源图片\r\nconst httpAsset = cc.Class({\r\n    extends: cc.Component,\r\n    // 开启适配\r\n    // startUpdateCanvasSize(){\r\n    //     // this.updateCanvasSize();\r\n    //     // cc.view.setResizeCallback(() => {\r\n    //     //     this.updateCanvasSize();\r\n    //     // })\r\n    // }\r\n    // 自由切换横竖屏，动态设置设计分辨率和适配模式。\r\n    // updateCanvasSize() {\r\n    //     let size = cc.view.getFrameSize();\r\n    //     if (size.width > size.height) {\r\n    //         this.canvas.fitWidth = false;\r\n    //         this.canvas.fitHeight = true;\r\n    //         this.canvas.designResolution = cc.size(1920, 1080);\r\n    //         this.showLandscape();\r\n    //     } else {\r\n    //         this.canvas.fitWidth = true;\r\n    //         this.canvas.fitHeight = false;\r\n    //         this.canvas.designResolution = cc.size(1080, 1920);\r\n    //         this.showPortait();\r\n    //     }\r\n    // },\r\n    //引入的基础类--图片资源\r\n    //加载资源\r\n    _progressRuning(completeCount,totalCount,assets,describe){\r\n        //加载进度回调\r\n        var progressBar =   cc.find('/progressBar',http_globalData.model_onload_loading_new).getComponent(cc.ProgressBar);\r\n        //加载进度回调 \r\n        progressBar.progress = completeCount / totalCount;\r\n        // console.log(progressBar.progress)\r\n        progressBar.completeCount = completeCount;\r\n        progressBar.totalCount = totalCount;          \r\n        var sys_label =  cc.find('/progressBar/sys_label',http_globalData.model_onload_loading_new).getComponent(cc.Label);\r\n        var sys_des =  cc.find('/progressBar/sys_des',http_globalData.model_onload_loading_new).getComponent(cc.Label);\r\n        //加载生物\r\n        if(http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].type=='图标生物'){\r\n            var asset = assets.content\r\n            // 检查资源是否为图片类型\r\n            if(asset instanceof cc.SpriteFrame){\r\n                var newname = asset.name;\r\n                http_globalAsset.http_base_asset_biology[newname] = asset \r\n                sys_des.string =  describe+'/图标生物/'+newname\r\n            }\r\n        }\r\n        //加载生物\r\n        if(http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].type=='图标装备'){\r\n            var asset = assets.content\r\n            // 检查资源是否为图片类型\r\n            if(asset instanceof cc.SpriteFrame){\r\n                var newname = asset.name;\r\n                http_globalAsset.http_base_asset_zhuangbei[newname] = asset \r\n                sys_des.string =  describe+'/图标装备/'+newname\r\n            }\r\n        }\r\n        //加载生物\r\n        if(http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].type=='图标技能'){\r\n            var asset = assets.content\r\n            // 检查资源是否为图片类型\r\n            if(asset instanceof cc.SpriteFrame){\r\n                var newname = asset.name;\r\n                http_globalAsset.http_base_asset_skill[newname] = asset \r\n                sys_des.string =  describe+'/图标技能/'+newname\r\n            }\r\n        }\r\n        //加载生物\r\n        if(http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].type=='图标技能效果'){\r\n            var asset = assets.content\r\n            // 检查资源是否为图片类型\r\n            if(asset instanceof cc.SpriteFrame){\r\n                var newname = asset.name;\r\n                http_globalAsset.http_base_asset_xiaoguo[newname] = asset \r\n                sys_des.string =  describe+'/图标技能效果/'+newname\r\n            }\r\n        }\r\n        //加载生物\r\n        if(http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].type=='图标世界'){\r\n            var asset = assets.content\r\n            // 检查资源是否为图片类型\r\n            if(asset instanceof cc.SpriteFrame){\r\n                var newname = asset.name;\r\n                http_globalAsset.http_base_asset_word[newname] = asset \r\n                sys_des.string =  describe+'/图标世界/'+newname\r\n            }\r\n        }\r\n\r\n        sys_label.string = parseInt( progressBar.progress * 100) + '%';\r\n        // if( this.resource.type=='json'){\r\n        //     // console.log(this.resource);  // json\r\n        //     // 从服务器加载mp3来进行播放\r\n        //     // this.audio.clip = ret;\r\n        //     // this.audio.play();\r\n        // }\r\n        // if( this.resource.type=='png'||this.resource.type=='jpg'){\r\n        //      console.log(res);  // json\r\n        //     //res是cc.Texture2D这样对象 \r\n        //     //   this.node.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(res)\r\n        //     // this.headpic.spriteFrame.setTexture(res);\r\n        //     // this.node.spriteFrame.setTexture(res);\r\n        //     // this.sprite.spriteFrame.setContentSize(res.getContentSize());\r\n        //     // this.node.getComponent(cc.Sprite).spriteFrame = res;\r\n        // }\r\n        // if( this.resource.type=='mp3'){\r\n        //     console.log(res);  // mp3\r\n        //     // this.audio.clip = res;\r\n        //     // this.audio.play();\r\n        //     // 从服务器加载mp3来进行播放\r\n        //     this.current = cc.audioEngine.play(res.url, false, 1);\r\n        // }\r\n    },\r\n    // 回调\r\n    _progressCallback(completeCount, totalCount,item) {\r\n        var describe = '['+ parseInt(http_globalAsset.http_base_asset_num+1 )+ '/'+  http_globalAsset.loading_asset.length +']'+ http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].describe\r\n        this._progressRuning(completeCount,totalCount,item,describe)\r\n    },\r\n    // 回调\r\n    _completeCallback: function(err, texture) {\r\n        //加载完成回调\r\n        if(http_globalAsset.http_base_asset_num<http_globalAsset.loading_asset.length-1){   \r\n            if(http_globalAsset.http_base_asset_num>http_globalAsset.loading_asset.length){ return }\r\n            http_globalAsset.http_base_asset_num = http_globalAsset.http_base_asset_num+1\r\n            this.loading_asset(); //下一个资源\r\n        }else{\r\n            this.loadnextScene() //下一场景 \r\n        }\r\n    },\r\n    //加载资源\r\n    loading_asset( ){\r\n        //默认从1开始\r\n        var url = cc.loader.loadResDir(http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].url,this._progressCallback.bind(this), this._completeCallback.bind(this));\r\n        cc.loader.release(url);\r\n    },\r\n    //加载场景\r\n    loadnextScene(){\r\n        //加载场景-- 场景为空， 关闭进度条\r\n         if(http_globalAsset.http_base_redict_sence==''){\r\n             cc.find('Canvas/进度条').parent.removeChild(cc.find('Canvas/进度条'));\r\n         }else{\r\n             //预加载场景并获得加载进度\r\n             cc.director.preloadScene(http_globalAsset.http_base_redict_sence,function (completeCount, totalCount,item) {\r\n                 httpRequestAsset._progressRuning(completeCount,totalCount,item,'加载场景..')\r\n             }, function (){\r\n                 cc.director.loadScene(http_globalAsset.http_base_redict_sence, function () {  \r\n                     // spawnTools();  \r\n                 });\r\n             })\r\n         }\r\n     },\r\n\r\n\r\n    //加载材质\r\n    async  http_material_yaohuang() {\r\n        return new Promise(resolve => {    \r\n            // var _this =this;\r\n            var label ='/materials/builtin_摇晃';\r\n            cc.loader.loadRes(label, cc.Material, function(err, res) {\r\n                http_globalAsset.material_yaohuang = cc.Material.getInstantiatedMaterial(res)\r\n                // _this. materialTime(materialPrefab)\r\n                // // 计算每帧的纹理偏移量\r\n                // this.uvOffset = 1 / this.totalFrames;\r\n                // // 开始播放动画\r\n                // this.schedule(this.updateAnimation, 1 / this.framesPerSecond);\r\n                resolve();\r\n            })\r\n        });\r\n    },\r\n    materialTime(materialPrefab){\r\n        if(materialPrefab){\r\n            materialPrefab.getComponent(cc.Sprite).setMaterial(0,http_globalAsset.material_yaohuang)\r\n            // 定义一个回调函数\r\n            // httpRequestBagApi.\r\n            // 使用 this.schedule 方法来调用这个回调函数，它每帧都会被执行\r\n            // this.schedule(this.update,0);\r\n            // 定义一个回调函数\r\n            var time =0;\r\n            this.updateEveryFrame = function (dt) {\r\n                // dt 是时间间隔，每帧 dt 的值大概是 0.016 秒（即 1/60 秒）\r\n                // 这里可以放置每帧都需要执行的逻辑\r\n                time += dt;\r\n                materialPrefab.getMaterial(0).setProperty(\"u_time\",time) \r\n            };\r\n            // 使用 this.schedule 方法来调用这个回调函数，它每帧都会被执行\r\n            this.schedule(this.updateEveryFrame, 0);\r\n        }\r\n    },\r\n});\r\nwindow.httpRequestAsset = new httpAsset();"]}