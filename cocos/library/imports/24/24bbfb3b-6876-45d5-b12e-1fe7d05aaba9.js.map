{"version":3,"sources":["assets\\Script\\commonApi\\asset.js"],"names":["httpAsset","cc","Class","Component","_progressRuning","completeCount","totalCount","assets","describe","progressBar","find","http_globalData","model_onload_loading_new","getComponent","ProgressBar","progress","sys_label","Label","sys_des","http_globalAsset","loading_asset","http_base_asset_num","type","asset","content","SpriteFrame","newname","name","http_base_asset_biology","string","http_base_asset_zhuangbei","http_base_asset_skill","http_base_asset_xiaoguo","http_base_asset_word","parseInt","_progressCallback","item","length","_completeCallback","err","texture","loadnextScene","url","loader","loadResDir","bind","release","http_base_redict_sence","parent","removeChild","director","preloadScene","httpRequestAsset","loadScene","window"],"mappings":"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","sourceRoot":"/","sourcesContent":["// 加载资源图片\r\nconst httpAsset = cc.Class({\r\n    extends: cc.Component,\r\n    //引入的基础类--图片资源\r\n    //加载资源\r\n    _progressRuning(completeCount,totalCount,assets,describe){\r\n        //加载进度回调\r\n        var progressBar =   cc.find('/progressBar',http_globalData.model_onload_loading_new).getComponent(cc.ProgressBar);\r\n        //加载进度回调 \r\n        progressBar.progress = completeCount / totalCount;\r\n        // console.log(progressBar.progress)\r\n        progressBar.completeCount = completeCount;\r\n        progressBar.totalCount = totalCount;          \r\n        var sys_label =  cc.find('/progressBar/sys_label',http_globalData.model_onload_loading_new).getComponent(cc.Label);\r\n        var sys_des =  cc.find('/progressBar/sys_des',http_globalData.model_onload_loading_new).getComponent(cc.Label);\r\n        //加载生物\r\n        if(http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].type=='图标生物'){\r\n            var asset = assets.content\r\n            // 检查资源是否为图片类型\r\n            if(asset instanceof cc.SpriteFrame){\r\n                var newname = asset.name;\r\n                http_globalAsset.http_base_asset_biology[newname] = asset \r\n                sys_des.string =  describe+'/图标生物/'+newname\r\n            }\r\n        }\r\n        //加载生物\r\n        if(http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].type=='图标装备'){\r\n            var asset = assets.content\r\n            // 检查资源是否为图片类型\r\n            if(asset instanceof cc.SpriteFrame){\r\n                var newname = asset.name;\r\n                http_globalAsset.http_base_asset_zhuangbei[newname] = asset \r\n                sys_des.string =  describe+'/图标装备/'+newname\r\n            }\r\n        }\r\n        //加载生物\r\n        if(http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].type=='图标技能'){\r\n            var asset = assets.content\r\n            // 检查资源是否为图片类型\r\n            if(asset instanceof cc.SpriteFrame){\r\n                var newname = asset.name;\r\n                http_globalAsset.http_base_asset_skill[newname] = asset \r\n                sys_des.string =  describe+'/图标技能/'+newname\r\n            }\r\n        }\r\n        //加载生物\r\n        if(http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].type=='图标技能效果'){\r\n            var asset = assets.content\r\n            // 检查资源是否为图片类型\r\n            if(asset instanceof cc.SpriteFrame){\r\n                var newname = asset.name;\r\n                http_globalAsset.http_base_asset_xiaoguo[newname] = asset \r\n                sys_des.string =  describe+'/图标技能效果/'+newname\r\n            }\r\n        }\r\n        //加载生物\r\n        if(http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].type=='图标世界'){\r\n            var asset = assets.content\r\n            // 检查资源是否为图片类型\r\n            if(asset instanceof cc.SpriteFrame){\r\n                var newname = asset.name;\r\n                http_globalAsset.http_base_asset_word[newname] = asset \r\n                sys_des.string =  describe+'/图标世界/'+newname\r\n            }\r\n        }\r\n\r\n        sys_label.string = parseInt( progressBar.progress * 100) + '%';\r\n        // if( this.resource.type=='json'){\r\n        //     // console.log(this.resource);  // json\r\n        //     // 从服务器加载mp3来进行播放\r\n        //     // this.audio.clip = ret;\r\n        //     // this.audio.play();\r\n        // }\r\n        // if( this.resource.type=='png'||this.resource.type=='jpg'){\r\n        //      console.log(res);  // json\r\n        //     //res是cc.Texture2D这样对象 \r\n        //     //   this.node.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(res)\r\n        //     // this.headpic.spriteFrame.setTexture(res);\r\n        //     // this.node.spriteFrame.setTexture(res);\r\n        //     // this.sprite.spriteFrame.setContentSize(res.getContentSize());\r\n        //     // this.node.getComponent(cc.Sprite).spriteFrame = res;\r\n        // }\r\n        // if( this.resource.type=='mp3'){\r\n        //     console.log(res);  // mp3\r\n        //     // this.audio.clip = res;\r\n        //     // this.audio.play();\r\n        //     // 从服务器加载mp3来进行播放\r\n        //     this.current = cc.audioEngine.play(res.url, false, 1);\r\n        // }\r\n    },\r\n    // 回调\r\n    _progressCallback(completeCount, totalCount,item) {\r\n        var describe = '['+ parseInt(http_globalAsset.http_base_asset_num+1 )+ '/'+  http_globalAsset.loading_asset.length +']'+ http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].describe\r\n        this._progressRuning(completeCount,totalCount,item,describe)\r\n    },\r\n    // 回调\r\n    _completeCallback: function(err, texture) {\r\n        //加载完成回调\r\n        if(http_globalAsset.http_base_asset_num<http_globalAsset.loading_asset.length-1){   \r\n            if(http_globalAsset.http_base_asset_num>http_globalAsset.loading_asset.length){ return }\r\n            http_globalAsset.http_base_asset_num = http_globalAsset.http_base_asset_num+1\r\n            this.loading_asset(); //下一个资源\r\n        }else{\r\n            this.loadnextScene() //下一场景 \r\n        }\r\n    },\r\n    //加载资源\r\n    loading_asset( ){\r\n        //默认从1开始\r\n        var url = cc.loader.loadResDir(http_globalAsset.loading_asset[http_globalAsset.http_base_asset_num].url,this._progressCallback.bind(this), this._completeCallback.bind(this));\r\n        cc.loader.release(url);\r\n    },\r\n    //加载场景\r\n    loadnextScene(){\r\n        //加载场景-- 场景为空， 关闭进度条\r\n         if(http_globalAsset.http_base_redict_sence==''){\r\n             cc.find('Canvas/进度条').parent.removeChild(cc.find('Canvas/进度条'));\r\n         }else{\r\n             //预加载场景并获得加载进度\r\n             cc.director.preloadScene(http_globalAsset.http_base_redict_sence,function (completeCount, totalCount,item) {\r\n                 httpRequestAsset._progressRuning(completeCount,totalCount,item,'加载场景..')\r\n             }, function (){\r\n                 cc.director.loadScene(http_globalAsset.http_base_redict_sence, function () {  \r\n                     // spawnTools();  \r\n                 });\r\n             })\r\n         }\r\n     },\r\n});\r\nwindow.httpRequestAsset = new httpAsset();"]}