{"version":3,"sources":["assets\\Script\\http.js"],"names":["https_url","HttpHelper","cc","Class","Component","onLoad","image_cache","current","audioEngine","play","res","url","sys","isNative","httpUrl","new_url","httpUrlJson","httpGets","callback","xhr","loader","getXMLHttpRequest","onreadystatechange","readyState","status","respone","responseText","open","setRequestHeader","timeout","send","httpPostLogin","params","token","localStorage","getItem","JSON","parse","stringify","httpPost","_this","new_respone","code","director","loadScene","urlConfig","playGame","sence","task","_task","loadRes","errorMessage","loadedResource","log","Prefab","TipBoxPrefab","instantiate","find","addChild","fightint","progress","preloadScene","completeCount","totalCount","item","progressBar","getComponent","ProgressBar","sys_label","Label","string","parseInt","map_int","userid","data","setItem","sid","i","img_list","remoteUrl","httpRequest","resources","preload","SpriteFrame","load","err","texture","macro","CLEANUP_IMAGE_CACHE","dynamicAtlasManager","enabled","maxFrameSize","sence_login","sence_jiaose","sence_register","sence_jiangli","sence_chongzhi","sence_zhifu","sence_dating","sence_zhutian","sence_chuangzao","sence_shenmo","sence_mijing","sence_wangu","sence_tiandi","sence_zhenyaota","sence_ditu","sence_zhandou"],"mappings":"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","sourceRoot":"/","sourcesContent":["/**\r\n * Http 请求封装\r\n */\r\nvar https_url = 'https://www.aheart.cn';\r\n// var https_url = 'http://cs.aheart.com';\r\nconst HttpHelper = cc.Class({\r\n    extends: cc.Component,\r\n    // statics: {\r\n    // },\r\n    // properties: {\r\n\r\n    // },\r\n    onLoad () {\r\n        // 开启调试\r\n        // cc.dynamicAtlasManager.showDebug(true);\r\n        // 关闭调试\r\n        // cc.dynamicAtlasManager.showDebug(false);\r\n        // 从服务器加载mp3来进行播放\r\n        //动态合图\r\n        this.image_cache();\r\n        this.current = cc.audioEngine.play(res.url, false, 1);  \r\n        //配置路径\r\n        cc.sys.isNative =0;\r\n    },\r\n    /**\r\n     * get请求\r\n     * @param {string} url\r\n     * @param {function} callback \r\n     */\r\n        httpUrl(new_url){\r\n            cc.sys.isNative =1;\r\n            return new_url?https_url+'/app/api/file-content?url='+https_url+new_url:'';\r\n            //https://www.aheart.cn/app/api/file-content?url=https://www.aheart.cn/app/loading/loading.jpg\r\n        },\r\n        httpUrlJson(new_url){\r\n            cc.sys.isNative =1;\r\n            return https_url+'/app/api/file-json?url='+https_url+new_url;\r\n            //https://www.aheart.cn/app/api/file-content?url=https://www.aheart.cn/app/loading/loading.jpg\r\n        },\r\n        httpGets: function (url, callback) {\r\n            var url =https_url+url;\r\n            var xhr = cc.loader.getXMLHttpRequest();\r\n            xhr.onreadystatechange = function () {\r\n                if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n                    var respone = xhr.responseText;\r\n                    callback(respone);\r\n                }\r\n            };\r\n            xhr.open(\"GET\", url, true);\r\n            if (cc.sys.isNative) {\r\n                xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\");\r\n            }\r\n        \r\n            // note: In Internet Explorer, the timeout property may be set only after calling the open()\r\n            // method and before calling the send() method.\r\n            xhr.timeout = 5000;// 5 seconds for timeout\r\n        \r\n            xhr.send();\r\n        },\r\n        \r\n        httpPostLogin: function (url, params, callback) {\r\n            var token = cc.sys.localStorage.getItem('token');\r\n            // cc.log(token)\r\n            params['token'] = token;\r\n            var url =https_url+url;\r\n            var xhr = cc.loader.getXMLHttpRequest();\r\n            xhr.onreadystatechange = function () {\r\n                // cc.log('xhr.readyState='+xhr.readyState+'  xhr.status='+xhr.status);\r\n                if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n                    var respone = xhr.responseText;\r\n                    callback(JSON.parse(respone));  // json 转数组\r\n                }else{\r\n                    //   callback(-1);\r\n                }\r\n            };\r\n            xhr.open(\"POST\", url, true);\r\n            if (cc.sys.isNative) {\r\n                xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\");\r\n            }\r\n            // xhr.setRequestHeader(\"Http-Edition\", \"1.0.0.0\");  // 版本\r\n            // xhr.setRequestHeader(\"Ip\", \"192.168.1.1\");\r\n            // xhr.setRequestHeader(\"Http-Token\", \"gzipdeflate\");\r\n            xhr.timeout = 5000;// 5 seconds for timeout\r\n            // xhr.setRequestHeader('Content-Type', 'application/json,multipart/form-data');\r\n            xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded; charset=utf-8\")\r\n            // xhr.send(JSON.stringify(params));\r\n            xhr.send('data='+JSON.stringify(params));\r\n            //  xhr.send(params);\r\n\r\n        },\r\n        //带token访问\r\n        httpPost: function (url, params, callback) {\r\n            var _this =this;\r\n            var token = cc.sys.localStorage.getItem('token');\r\n            // cc.log(token)\r\n            params['token'] = token;\r\n            var url =https_url+url;\r\n            var xhr = cc.loader.getXMLHttpRequest();\r\n            xhr.onreadystatechange = function () {\r\n                // cc.log('xhr.readyState='+xhr.readyState+'  xhr.status='+xhr.status);\r\n                if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n                    var respone = xhr.responseText;\r\n                    var new_respone =JSON.parse(respone);\r\n                    if(new_respone.code==0){\r\n                        //未登录\r\n                        // console.log(JSON.parse(respone))\r\n                        cc.director.loadScene(_this.urlConfig(\"sence_login\"));\r\n                    }else{\r\n                        callback(JSON.parse(respone));  // json 转数组\r\n                    }\r\n                }else{\r\n                    //   callback(-1);\r\n                }\r\n            };\r\n            xhr.open(\"POST\", url, true);\r\n            if (cc.sys.isNative) {\r\n                xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\");\r\n            }\r\n            // xhr.setRequestHeader(\"Http-Edition\", \"1.0.0.0\");  // 版本\r\n            // xhr.setRequestHeader(\"Ip\", \"192.168.1.1\");\r\n            // xhr.setRequestHeader(\"Http-Token\", \"gzipdeflate\");\r\n            xhr.timeout = 5000;// 5 seconds for timeout\r\n            // xhr.setRequestHeader('Content-Type', 'application/json,multipart/form-data');\r\n            // xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n            xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded; charset=utf-8\")\r\n            // xhr.send(JSON.stringify(params));\r\n            xhr.send('data='+JSON.stringify(params));\r\n            //  xhr.send(params);\r\n\r\n        },\r\n        //场景加载--进度条\r\n        playGame(sence,task) {\r\n            var _task =task||0;\r\n            var _this =this;\r\n            //加载预制资源 PrefabUrl为 预制资源在 资源中的路径--预加载的进度条\r\n            cc.loader.loadRes('./sprite_loading', function(errorMessage,loadedResource){\r\n                //检查资源加载\r\n                if( errorMessage ) { cc.log( '载入预制资源失败, 原因:' + errorMessage ); return; }\r\n                if( !(loadedResource instanceof cc.Prefab ) ) { cc.log( '你载入的不是预制资源!' ); return; }\r\n                //开始实例化预制资源\r\n                let TipBoxPrefab = cc.instantiate(loadedResource);\r\n                //将预制资源添加到父节点\r\n                // CanvasNode.addChild(TipBoxPrefab);\r\n                cc.find('Canvas').addChild(TipBoxPrefab);\r\n                //请求战斗记录\r\n                if(_task==1){\r\n                    _this.fightint(sence);\r\n                }else{\r\n                    _this.progress(sence);\r\n                }\r\n\r\n            });\r\n        },\r\n\r\n        progress(sence){\r\n            //预加载场景并获得加载进度\r\n            cc.director.preloadScene(sence,function (completeCount, totalCount,item) {\r\n                var item =item||0;\r\n                var totalCount =totalCount||0;\r\n                var completeCount =completeCount||0;\r\n                var progressBar = cc.find('Canvas/loading/progressBar').getComponent(cc.ProgressBar);\r\n                // console.log(item)\r\n                // console.log(completeCount)\r\n                // console.log(totalCount)\r\n                //加载进度回调\r\n                // console.log('资源 ' + completeCount + '加载完成！资源加载中...');\r\n                // console.log('加载场景资源');\r\n                progressBar.progress = completeCount / totalCount;\r\n                // console.log(progressBar.progress)\r\n                progressBar.completeCount = completeCount;\r\n                progressBar.totalCount = totalCount;\r\n                // resource = item;//实力的对象\r\n                // // 代码里面获取cc.Label组件, 修改文本内容\r\n                // //在代码里面获取cc.Label组件\r\n                var sys_label = cc.find('Canvas/loading/progressBar/sys_label').getComponent(cc.Label);\r\n                sys_label.string = parseInt( progressBar.progress * 100) + '%';\r\n                // if( this.resource.type=='mp3'){\r\n                //     // console.log(res);  // mp3\r\n                //     // this.audio.clip = res;\r\n                //     // this.audio.play();\r\n                //     // 从服务器加载mp3来进行播放\r\n                //     this.current = cc.audioEngine.play(res.url, false, 1);\r\n                // }\r\n            }, function (){\r\n                // progressBar.hide();\r\n                //加载场景\r\n                cc.director.loadScene(sence, function () {  \r\n                        // spawnTools();\r\n                });\r\n            })\r\n        },\r\n        //请求战斗--写入文本记录\r\n        fightint(sence){\r\n            var _this =this;\r\n            var map_int = cc.sys.localStorage.getItem('figthing_map_int'); //读取数据--临时地图id\r\n            var userid = cc.sys.localStorage.getItem('figthing_userid'); //读取数据--玩家对战id\r\n            if(map_int==''&&userid==''){\r\n                cc.director.loadScene(_this.urlConfig(\"sence_dating\"));\r\n            }else{\r\n                _this.httpPost('/app/app-apinew/fight', {\r\n                  'map_int': map_int,\r\n                  'userid': userid,\r\n                }, function (data) {\r\n                    //战斗历史路径\r\n                    if(data.code==1){\r\n                        cc.sys.localStorage.setItem('figthing_remote_url', data.data.sid); \r\n                        for (let i=0; i<data.data.img_list; i++) {\r\n                            let remoteUrl = httpRequest.httpUrl(img_list[i]);\r\n                            cc.resources.preload(remoteUrl, cc.SpriteFrame);\r\n                            cc.loader.load({ url: remoteUrl }, function (err, texture) {  \r\n                                _this.progress(sence)\r\n                            });\r\n                        }\r\n                        // // console.log(remoteUrl)\r\n                        // cc.loader.load({ url: remoteUrl }, function (err, texture) {  \r\n                        //   _this.home.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\r\n                        // });\r\n                    }else{\r\n                        callback(JSON.parse(data));  // json 转数组\r\n                        // callback(-1);\r\n                    }\r\n                })   \r\n            }\r\n        },\r\n        image_cache(){\r\n            //动态合图\r\n            cc.macro.CLEANUP_IMAGE_CACHE = false;\r\n            cc.dynamicAtlasManager.enabled = true;\r\n            cc.dynamicAtlasManager.maxFrameSize = 2048;\r\n        },\r\n        urlConfig(url){\r\n            // //配置场景路径\r\n            var sence = {\r\n                //登录\r\n                sence_login:\"login/登录\",\r\n                sence_jiaose:\"login/角色\",\r\n                sence_register:\"login/register\",\r\n                //商城\r\n                sence_jiangli:\"story/jiangli\",\r\n                sence_chongzhi:\"story/chongzhi\",\r\n                sence_zhifu:\"story/zhifu\",\r\n                //大厅\r\n                sence_dating:\"home/大厅\",\r\n                sence_zhutian:\"home/诸天万界\",\r\n                sence_chuangzao:\"home/创造生物\",\r\n                sence_shenmo:\"home/神魔炼狱\",\r\n                sence_mijing:\"home/秘境探索\",\r\n                sence_wangu:\"home/万古仙门\",\r\n                sence_tiandi:\"home/天地熔炉\",\r\n                sence_zhenyaota:\"home/镇妖塔\",\r\n                //场景\r\n                sence_ditu:\"map/诸天地图\",\r\n                sence_zhandou:\"战斗场景\",\r\n\r\n                \r\n            }\r\n            return sence[url];\r\n        },\r\n});\r\n// httpRequest = new HttpHelper();\r\n// window.HttpHelper = new HttpHelper();"]}