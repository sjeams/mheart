{"version":3,"sources":["assets\\Script\\login\\myserver.js"],"names":["HttpHelper","require","httpRequest","cc","Class","Component","properties","register_alert","Label","register_login_name","EditBox","register_login_password","onLoad","loginname","sys","localStorage","getItem","password","getComponent","string","tokenlogin","loader","loadRes","err","res","json","params","token","log","httpPost","data","release","code","login","_this","setItem","node","active","btnClick1","event","customEventData","JSON","parse","stringify","server","userinfo","director","loadScene","callback","start","show_dlg","hidden_dlg"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\nvar HttpHelper = require(\"http\");\r\n// var fs = require('fs'); // 引入fs模块\r\n// var globaluserinfo = require(\"GlobaluserInfo\");\r\nlet httpRequest =  new HttpHelper();  \r\ncc.Class({\r\n    extends: cc.Component,\r\n \r\n    properties: {\r\n        register_alert: cc.Label,\r\n        register_login_name: cc.EditBox,\r\n        register_login_password: cc.EditBox\r\n    },\r\n \r\n    onLoad: function () {\r\n        var loginname =cc.sys.localStorage.getItem('loginname');\r\n        var password =cc.sys.localStorage.getItem('password');\r\n        if(loginname){\r\n           this.register_login_name.getComponent(cc.EditBox).string=loginname;\r\n        }\r\n        if(loginname){\r\n            this.register_login_password.getComponent(cc.EditBox).string=password;\r\n        }\r\n        // 操作文本--读取用户信息\r\n        this.tokenlogin(); // 快捷登录\r\n\r\n        // // 账号密码登录\r\n        // this.login();\r\n        //储存缓存\r\n        // cc.sys.localStorage.setItem('token', value);\r\n        // cc.sys.localStorage.getItem(key);\r\n        // cc.sys.localStorage.removeItem(key);\r\n\r\n        // 保存最高分到本地\r\n        // const KEY_BEST_SCORE = \"bestScore\";\r\n        // let bestScore = cc.sys.localStorage.getItem(KEY_BEST_SCORE);\r\n        // if (bestScore === \"null\" || this.score > bestScore) {\r\n        //     bestScore = this.score;\r\n        // }\r\n        // cc.sys.localStorage.setItem(KEY_BEST_SCORE, bestScore);\r\n        \r\n\r\n \r\n    },\r\n     \r\n    tokenlogin: function(){\r\n        // 获取本地json  信息\r\n        // cc.loader.load( cc.url.raw(\"resources/login.json\"),function(err,res){  \r\n        cc.loader.loadRes('login.json',function(err,res){   //默认resources\r\n            let json = res.json;\r\n            var params = {\r\n                'token': json.token,\r\n            };\r\n            cc.log(json.token); \r\n            var res = httpRequest.httpPost('https://www.mheart.xyz/app/api-server/token-login', params ,function (data) {\r\n                cc.loader.release('resources/login.json'); //释放json 资源\r\n                // if(cc.sys.isNative){  //  jsb.fileUtils不支持 web  读写\r\n                //     jsb.fileUtils.writeStringToFile(data,token)\r\n                // }\r\n                // cc.log(data); \r\n                // 未登录弹出登录\r\n                if(data.code==0){\r\n                    // this.loginbox.node.active = false;  // 进度隐藏\r\n                }\r\n             \r\n            });\r\n        })\r\n\r\n    },\r\n\r\n    login: function(){\r\n\r\n       var loginname = this.register_login_name.getComponent(cc.EditBox).string;\r\n       var password = this.register_login_password.getComponent(cc.EditBox).string;\r\n        var params = {\r\n            'loginname': loginname,\r\n            'password': password,\r\n            // 'loginname': 'yincan1993',\r\n            // 'password': 123456,\r\n        };\r\n\r\n        var _this= this;\r\n        httpRequest.httpPost('https://www.mheart.xyz/app/api-server/login', params ,function (data) {\r\n            cc.log(data); \r\n            if(data.code==1){\r\n                // _this.register_alert.color =  new cc.color('#BDFF00');\r\n                _this.register_alert.string ='';\r\n                cc.sys.localStorage.setItem('token', data.token);\r\n                cc.sys.localStorage.setItem('loginname', loginname);\r\n                cc.sys.localStorage.setItem('password', password);\r\n                _this.node.active =false;\r\n            }else{\r\n                _this.register_alert.string ='账号密码错误!';\r\n            }\r\n            //操作文本--修改用户信息\r\n        });\r\n\r\n    },\r\n\r\n    btnClick1: function (event, customEventData) {\r\n        // // 请求登录接口\r\n        // var params = {\r\n        //         'loginname': 'yincan1993',\r\n        //         'password': 123456,\r\n        //         'serverid': 1,\r\n        // };\r\n        // cc.sys.localStorage.setItem('params', JSON.stringify(params));\r\n        var params = JSON.parse(cc.sys.localStorage.getItem(\"params\"));\r\n        var token =cc.sys.localStorage.getItem('token');\r\n    \r\n        // cc.log(value); \r\n        // let httpRequest =  new HttpHelper();  \r\n        httpRequest.httpPost('https://www.mheart.xyz/app/api-server/user-login', {'token':token} ,function (data) {\r\n            cc.log(data); \r\n            if(data.code==0){ // 登录失败，或本地数据失效\r\n                // 弹窗\r\n            }else{\r\n                // 设置服务器\r\n                cc.sys.localStorage.setItem('server', JSON.stringify(data.data.server));\r\n                if(data.code==1){// 登录成功，进入游戏\r\n                    // cc.log(data.data.userinfo); \r\n                    cc.sys.localStorage.setItem('userinfo', JSON.stringify(data.data.userinfo)); \r\n                    cc.director.loadScene('home/dating');\r\n                    // cc.sys.localStorage.setItem('userinfo', JSON.stringify(data.data.userinfo));\r\n                    // cc.sys.localStorage.getItem(key); //读取数据\r\n                }\r\n                if(data.code==2){ // 登录成功，未定义角色\r\n                    // 进入定义角色界面     \r\n                    var server = JSON.parse(cc.sys.localStorage.getItem('server'));\r\n                    // cc.log(server); \r\n                    // 创建角色\r\n                    cc.director.loadScene('register');\r\n                }\r\n            }\r\n\r\n        });\r\n        \r\n        //这里 event 是一个 Touch Event 对象，你可以通过 event.target 取到事件的发送节点\r\n        // var node = event.target;\r\n        // var button = node.getComponent(cc.Button);\r\n        //这里的 customEventData 参数就等于你之前设置的 \"click1 user data\"\r\n        // cc.log(\"node=\", node.name, \" event=\", event.type, \" data=\", customEventData);\r\n    },\r\n\r\n    callback: function (event) {\r\n        // cc.log(data)\r\n        // var userCount =  cc.find(\"Canvas/ground/editbox_count\").getComponent(cc.EditBox).string;\r\n        // var userPassward =  cc.find(\"Canvas/ground/editbox_passward\").getComponent(cc.EditBox).string;\r\n        // console.log(\"用户账号：\"+userCount+ \"用户密码：\"+ userPassward);\r\n        // HttpHelp.login(userCount,userPassward,function(isSuccess,Data){\r\n        //     var info = Data;\r\n        //     if(true == isSuccess){\r\n        //         console.log(\"login  success!!!\");\r\n        //         console.log(info);\r\n        //         globaluserinfo.username = info.username;\r\n        //         globaluserinfo.gamepoint = info.gamepoint;\r\n        //         globaluserinfo.skey = info.skey;\r\n        //         globaluserinfo.userid = info.userid;\r\n \r\n        //         globaluserinfo.money = info.money;\r\n        //         globaluserinfo.userid = info.userid;\r\n        //         globaluserinfo.password = info.password;\r\n        //         globaluserinfo.salt = info.salt;\r\n \r\n        //         //登录成功后加载地图资源\r\n                cc.director.loadScene('map');\r\n        //     }else{\r\n        //         console.log(\"login  filed!!!\")\r\n        //     }\r\n        // });\r\n        \r\n    },\r\n \r\n    start () {\r\n \r\n    },\r\n \r\n    // update (dt) {},\r\n\r\n    show_dlg () {\r\n        this.node.active =true;\r\n    },\r\n    hidden_dlg () {\r\n        this.node.active =false;\r\n    }\r\n});\r\n"]}