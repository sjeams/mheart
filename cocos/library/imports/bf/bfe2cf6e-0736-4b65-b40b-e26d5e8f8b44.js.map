{"version":3,"sources":["assets\\Script\\登录\\home_login.js"],"names":["require","cc","Class","Component","properties","onLoad","httpRequestBagApi","http_music","tokenlogin","token","sys","localStorage","getItem","user_status","find","active","user_phone","httpRequest","httpPostLogin","data","log","code","loginname","userinfo","phone","slice","getComponent","Label","string","message","goGame","setItem","JSON","stringify","server","playGame","director","loadScene","start","show_dlg","node","hidden_dlg"],"mappings":"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","sourceRoot":"/","sourcesContent":["require(\"../common\"); \r\ncc.Class({\r\n    extends: cc.Component,\r\n \r\n    properties: {\r\n        // user_status:cc.Node,\r\n        // user_phone:cc.Label,\r\n        // register_login_name: cc.EditBox,\r\n        // register_login_password: cc.EditBox\r\n    },\r\n \r\n    async onLoad() {    \r\n        await httpRequestBagApi.http_music()\r\n        await this.tokenlogin(); // 快捷登录\r\n        // 操作文本--读取用户信息\r\n        // // 账号密码登录\r\n        // this.login();\r\n        //储存缓存\r\n        // cc.sys.localStorage.setItem('token', value);\r\n        // cc.sys.localStorage.getItem(key);\r\n        // cc.sys.localStorage.removeItem(key);\r\n\r\n        // 保存最高分到本地\r\n        // const KEY_BEST_SCORE = \"bestScore\";\r\n        // let bestScore = cc.sys.localStorage.getItem(KEY_BEST_SCORE);\r\n        // if (bestScore === \"null\" || this.score > bestScore) {\r\n        //     bestScore = this.score;\r\n        // }\r\n        // cc.sys.localStorage.setItem(KEY_BEST_SCORE, bestScore);\r\n    },\r\n    async tokenlogin(){\r\n        // 获取本地json  信息\r\n        // cc.loader.load( cc.url.raw(\"resources/login.json\"),function(err,res){  \r\n        // cc.loader.loadRes('login.json',function(err,res){   //默认resources\r\n        //     let json = res.json;\r\n        //     var params = {\r\n        //         'token': json.token,\r\n        //     };\r\n        //     cc.log(json.token); \r\n        //     var res = httpRequest.httpPostLogin('/app/api-server/token-login', params ,function (data) {\r\n        //         cc.loader.release('resources/login.json'); //释放json 资源\r\n        //         // if(cc.sys.isNative){  //  jsb.fileUtils不支持 web  读写\r\n        //         //     jsb.fileUtils.writeStringToFile(data,token)\r\n        //         // }\r\n        //         // cc.log(data); \r\n        //         // 未登录弹出登录\r\n        //         if(data.code==0){\r\n        //             // this.loginbox.node.active = false;  // 进度隐藏\r\n        //         }\r\n             \r\n        //     });\r\n        // })\r\n \r\n        var token = cc.sys.localStorage.getItem('token');\r\n        // cc.log(token)\r\n        //定位弹出窗口\r\n        var user_status  =cc.find(\"Canvas/server/user_status\");\r\n        user_status.active=true;\r\n        var user_phone  =cc.find(\"Canvas/server/user_status/user_phone\");\r\n        if(token){\r\n                httpRequest.httpPostLogin('/app/api-server/token-login', {'token':token} ,function (data) {\r\n                    // cc.loader.release('resources/login.json'); //释放json 资源\r\n                    // if(cc.sys.isNative){  //  jsb.fileUtils不支持 web  读写\r\n                    //     jsb.fileUtils.writeStringToFile(data,token)\r\n                    // }\r\n                 \r\n           \r\n                cc.log(data); \r\n                // 登录成功\r\n                if(data.code==1){\r\n                    // 其中slice(start, end)：用于提取字符串的片段\r\n                    // str.slice(1) 指下标为1之后的所有元素\r\n                    var loginname =  data.data.userinfo.loginname;\r\n                    var phone = loginname.slice(0,3) + \"****\" + loginname.slice(7,10);\r\n                    user_phone.getComponent(cc.Label).string=phone;\r\n                }else{\r\n                    user_phone.getComponent(cc.Label).string=data.message;\r\n                }\r\n            });\r\n        }else{\r\n            user_phone.getComponent(cc.Label).string=\"未登录\";\r\n        }\r\n    },\r\n \r\n \r\n    //开始游戏按钮--不作为登录，只是开始\r\n    goGame() {  \r\n        httpRequest.httpPostLogin('/app/api-server/user-login', {} ,function (data) {\r\n            // cc.log(data); \r\n            if(data.code==0){ // 登录失败，或本地数据失效\r\n                var user_status  =cc.find(\"Canvas/登录弹窗\");\r\n                user_status.active=true;\r\n                // 弹窗\r\n            }else{\r\n                // 设置服务器\r\n                cc.sys.localStorage.setItem('server', JSON.stringify(data.data.server));\r\n                if(data.code==1){// 登录成功，进入游戏\r\n                    // cc.log(data.data.userinfo); \r\n                    cc.sys.localStorage.setItem('userinfo', JSON.stringify(data.data.userinfo)); \r\n                    httpRequest.playGame(\"sence_dating\");\r\n                    // cc.sys.localStorage.setItem('userinfo', JSON.stringify(data.data.userinfo));\r\n                    // cc.sys.localStorage.getItem(key); //读取数据\r\n                }else if(data.code==2){ // 登录成功，未定义角色\r\n                    // 进入定义角色界面     \r\n                    // var server = JSON.parse(cc.sys.localStorage.getItem('server'));\r\n                    // cc.log(cc.sys.localStorage.getItem('token')); \r\n                    // 创建角色\r\n                    cc.director.loadScene('login/角色');\r\n                }\r\n            }\r\n        });\r\n        \r\n    },\r\n    start () {\r\n    },\r\n    show_dlg () {\r\n        this.node.active =true;\r\n    },\r\n    hidden_dlg () {\r\n        this.node.active =false;\r\n    }\r\n});\r\n"]}